<br>

<%= render partial: "/shared/admin_dashboard" %>

<div class="p-5">
	<h2>Realties</h2>

	<!-- Total Realties -->
  <p class="text-muted mb-3">
    Total Realties: <strong><%= @realties.total_count rescue @realties.size %></strong>
  </p>

  <!-- Search Form -->
	<div class="mb-4">
  <%= form_with url: admin_realties_path, method: :get, local: true, 
                class: "row g-2 align-items-center" do %>

    <div class="col-12 col-md-10">
      <%= text_field_tag :q, params[:q], 
            placeholder: "Search realties...", 
            class: "form-control w-100" %>
    </div>

    <div class="col-12 col-md-1">
      <%= select_tag :status, 
            options_for_select(Realty.statuses.keys.map { |s| [s.titleize, s] }, params[:status]), 
            include_blank: "All Statuses", 
            class: "form-select w-100" %>
    </div>

    <div class="col-12 col-md-1 d-grid">
      <%= submit_tag "Search", class: "btn btn-primary w-100" %>
    </div>
  <% end %>
</div>


  <% if @realties.any? %>
	<table class="table table-bordered">
	  <thead>
	    <tr>
	    	<th>#</th>
        <th>ID</th>
	      <th>Name</th>
	      <th>Broker</th>
	      <th>Email</th>
	      <th>Location</th>
	      <th>Status</th>
	      <th>Submitted</th>
	      <th>Actions</th>
	      <th></th>
	      <th></th>
	    </tr>
	  </thead>
	  <tbody>
	    <% @realties.each_with_index do |realty, index| %>
	      <tr>
					<td><%= (@realties.offset_value || 0) + index + 1 %></td>
          <td><%= realty.id %></td>
          <td>
					  <%= case realty.status
					      when "pending", "rejected"
					        link_to realty.name, admin_realty_path(realty)
					      when "approved"
					        link_to realty.name, realty_path(realty)
					      end %>
					</td>
	        <td><%= realty.head_broker.full_name %></td>
	        <td><%= realty.email %></td>
	        <td><%= realty.business_location %></td>
	        <td>
	        	<span class="badge 
				    <%= case realty.status
				        when "pending" then "badge-warning"
				        when "approved" then "badge-success"
				        when "rejected" then "badge-danger"
				        end %> text-black">
				    <%= realty.status.capitalize %>
	        </td>
	        <td><%= realty.created_at.to_date %></td>
	        <td>
	        	<%= link_to "View Application", admin_realty_path(realty), class: "btn btn-sm btn-light btn-sm" %>
	        	<% if realty.approved? %>
	        </td>
	        <td>
	        		<%= link_to "Show Realty", realty_path(realty), class: "btn btn-sm btn-secondary btn-sm" %>
	        	<% end %>
	        </td>
	        <td>
	        	<%= button_to "Delete",
              admin_realty_path(realty),
              method: :delete,
              data: { confirm: "Are you sure you want to delete this realty?" },
              form: { class: "d-inline" },
              class: "btn btn-sm btn-danger ms-1" %>
	        </td>
	      </tr>
	    <% end %>
	  </tbody>
	</table>

    <div class="mt-3">
      <%= paginate @realties %>
    </div>
  <% else %>
    <p>No realties found.</p>
  <% end %>
</div>
