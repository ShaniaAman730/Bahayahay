<br>

<%= render partial: "/shared/admin_dashboard" %>

<div class="p-5">
	<h2>Realties</h2>

	<div class="mb-4">
	  <%= form_with url: admin_realties_path, method: :get, local: true, class: "d-flex gap-2" do %>
	    <%= text_field_tag :q, params[:q], placeholder: "Search realties...", 
	          class: "form-control flex-grow-1" %> 

	    <%= select_tag :status, 
	          options_for_select(Realty.statuses.keys.map { |s| [s.titleize, s] }, params[:status]), 
	          include_blank: "All Statuses", 
	          class: "form-select w-auto" %> 

	    <%= submit_tag "Search", class: "btn btn-primary" %>
	  <% end %>
	</div>

  <% if @realties.any? %>
	<table class="table table-bordered">
	  <thead>
	    <tr>
	      <th>Name</th>
	      <th>Broker</th>
	      <th>Email</th>
	      <th>Location</th>
	      <th>Status</th>
	      <th>Submitted</th>
	      <th>Actions</th>
	    </tr>
	  </thead>
	  <tbody>
	    <% @realties.each do |realty| %>
	      <tr>
	        <td>
			  <%= case realty.status
			      when "pending", "rejected"
			        link_to realty.name, admin_realty_path(realty)
			      when "approved"
			        link_to realty.name, realty_path(realty)
			      end %>
			</td>
	        <td><%= realty.head_broker.full_name %></td>
	        <td><%= realty.email %></td>
	        <td><%= realty.business_location %></td>
	        <td>
	        	<span class="badge 
				    <%= case realty.status
				        when "pending" then "badge-warning"
				        when "approved" then "badge-success"
				        when "rejected" then "badge-danger"
				        end %> text-black">
				    <%= realty.status.capitalize %>
	        </td>
	        <td><%= realty.created_at.to_date %></td>
	        <td>
	        	<%= link_to "View Application", admin_realty_path(realty), class: "btn btn-sm btn-light btn-sm" %>
	        	<% if realty.approved? %>
	        		<%= link_to "Show Realty", realty_path(realty), class: "btn btn-sm btn-secondary btn-sm" %>
	        	<% end %>
	        	<%= button_to "Delete",
              admin_realty_path(realty),
              method: :delete,
              data: { confirm: "Are you sure you want to delete this realty?" },
              form: { class: "d-inline" },
              class: "btn btn-sm btn-danger ms-1" %>
	        </td>
	      </tr>
	    <% end %>
	  </tbody>
	</table>

    <div class="mt-3">
      <%= paginate @realties %>
    </div>
  <% else %>
    <p>No realties found.</p>
  <% end %>
</div>
