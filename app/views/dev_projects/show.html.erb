<div class="container mt-5">
  <div class="d-flex">
    <% if user_signed_in? && current_user.developer? %>
      <%= link_to dev_projects_path do %>
        <h1><i class="bi bi-arrow-left-circle text-success"></i></h1>
      <% end %>
    <% end %>
  <div class="listing-container">
  
      <% if @dev_project.project_photos.attached? %>
        <!-- First large image -->
        <div class="p1 mb-2 image-gallery">
          <%= image_tag @dev_project.project_photos.first,
              class: "img-thumbnail media",
              style: "width: 1175px; height: auto; object-fit: cover; cursor: pointer;",
              data: { index: 0 } %>
        </div>

        <!-- Thumbnails (rest of the gallery) -->
        <div class="d-flex flex-wrap gap-2 mb-4">
          <div class="image-gallery d-flex flex-wrap gap-2">
            <% @dev_project.project_photos[1..7].each_with_index do |photo, index| %>
              <div style="flex: 0 0 auto;">
                <%= image_tag photo,
                    class: "img-thumbnail media",
                    style: "width: 120px; height: 120px; object-fit: cover; cursor: pointer;",
                    data: { index: index + 1 } %> 
              </div>
            <% end %>
          </div>
        </div>
      <% end %>

      <!-- Modal -->
      <div id="galleryModal" class="modal" style="display:none;">
        <span class="close" onclick="closeModal()">&times;</span>
        <img class="modal-content" id="modalImage">
        <a class="prev" onclick="changeImage(-1)">&#10094;</a>
        <a class="next" onclick="changeImage(1)">&#10095;</a>
      </div>

      <div class="row">
        <!-- LEFT SIDE OF THE SCREEN -->
        <div class="col-12 col-sm-6 col-md-8">
          <div class="d-flex ml-2">
            <h2 class="ml-2"><%= @dev_project.title %></h2>
            <div class="vr mx-3 my-1" style="height: 30px;"></div>
            <p class="fw-light text-success border border-success px-1 mt-1 ml-1"><%= @dev_project.property_type %></p>
          </div>
            
         <h6 class="fw-light ml-2"><i class="bi bi-geo-alt-fill"></i>  <%= @dev_project.address %>, <%= @dev_project.barangay %>, Naga City</h6>

         <div class="row mt-2 mb-3 p-2">
          <h2>About the Project</h2>
          <p><%= @dev_project.description %></p>
        </div>

         <div class="container mt-2 mb-2 bg-light">  
          <div class="p-3">  
             <h5>Amenities</h5>
              <% groups = amenities_dev_projects(@dev_project).in_groups(5, false) %>
              <div class="row">
                <% groups.each do |group| %>
                  <div class="col-md-4">
                    <% group.each do |amenities_html| %>
                      <p><%= amenities_html.html_safe %></p>
                    <% end %>
                  </div>
                <% end %>
              </div>
            </div>
          </div>

        </div>

      <!-- RIGHT SIDE OF THE SCREEN -->
        <div class="col-12 col-md-4 mt-4">
          <div class="col-9 border border-secondary rounded p-3">
            <div class="row d-flex">
              <div class="col">
                  <% if @dev_project.user.persisted? && @dev_project.user.profile_photo.attached? %>
                    <%= image_tag @dev_project.user.profile_photo, class: "rounded-circle", size: "90x90" %>
                  <% else %>
                      <%= image_tag("no-profile.jpg", class: "rounded-circle", size: "90x90") %>
                  <% end %>
              </div>
              <div class="col mt-4">
                <h6 class="fw-light">Developer</h6>
                <h6 class="fw-semibold"><%= @dev_project.user.company_name %></h6>
              </div>
            </div>
              <div class="row p-2 mt-2">
                <a href="/users/<%= @dev_project.user.id %>" class="btn btn-outline-secondary btn-lg btn-block btn-sm" role="button">View Developer</a>
             </div>
            </div>
          </div>
        </div>
    <br>  

    <hr class="mt-5 mb-4">
    <h3 class="mb-4">Model Houses</h3>

    <% if @model_houses.any? %>
      <div class="row row-cols-1 row-cols-md-3 g-4">
        <% @model_houses.each do |model_house| %>
          <div class="col">
            <div class="card h-100 shadow-sm">
              <% if model_house.model_photos.attached? %>
                <%= image_tag model_house.model_photos.first, class: "card-img-top", style: "height: 200px; object-fit: cover;" %>
              <% else %>
                <div class="d-flex align-items-center justify-content-center bg-light" style="height: 200px;">
                <span class="text-muted">No photo available</span>
              <% end %>

              <div class="card-body p-3">
                <h5 class="card-title"><%= model_house.title %></h5>
                <strong><%= number_to_currency(model_house.price, unit: "â‚±", precision: 2, delimiter: ",") %></strong><br>
                <div class="d-flex flex-wrap gap-2 mb-3">
                  <span class="badge bg-secondary"><%= model_house.beds %> Beds</span>
                  <span class="badge bg-secondary"><%= model_house.baths %> Baths</span>
                  <span class="badge bg-secondary"><%= model_house.sqft %> Sq. ft.</span>
                </div>
                <p class="card-text"><%= truncate(model_house.description&.to_plain_text || "", length: 100) %></p>
              </div>

              <div class="card-footer bg-transparent border-0 mb-2">
                <%= link_to "View Details", model_house_path(model_house), class: "btn btn-outline-primary btn-sm" %>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <p class="text-muted fst-italic">No model houses available for this project yet.</p>
    <% end %>

    <br>

    <% if user_signed_in? && current_user.developer? %> 
    <hr class="hr p-2 mt-5" /> 
      <div class="d-flex p-1">
        <%= link_to "Edit", edit_dev_project_path(@dev_project), class: "btn btn-light" %>
        <%= button_to "Delete", @dev_project, method: :delete, class: "btn btn-danger ml-1" %>
     </div>
    <% end %>

    </div>    
   </div>
  </div>
  <div class="mb-5"></div>
  <div class="mb-5"></div>
</div>
